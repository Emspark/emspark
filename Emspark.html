<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EM'SPARK</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Mono+One&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <script src="./particles.min.js"></script>
  <style>
    body.dark {
  background: linear-gradient(to bottom, #1f2937, #4b5563, #111827);
  color: white;
}
.dark .text-black { color: white !important; }
.dark .bg-white { background-color: #1f2937 !important; }
.dark select, .dark input, .dark button {
  color: black;
}
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #ffedd5, #fdba74, #fb923c);
      min-height: 100vh;
      overflow-x: hidden;
    }
    #particles-js {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
    .hidden { display: none; }
    .fade { transition: opacity 0.5s ease-in-out; opacity: 0; }
    .fade.show { opacity: 1; }
    .logo-title {
      font-family: 'Rubik Mono One', sans-serif;
    }
    .translate-x-8 {
  transform: translateX(2rem);
}

.animate-slide-in {
  animation: slideIn 0.4s ease-out;
}

@keyframes slideIn {
  0% {
    transform: translateY(10px);
    opacity: 0;
  }
  100% {
    transform: translateY(0);
    opacity: 1;
  }
}

  </style>
</head>

<body onload="initializeApp()" class="p-4 sm:p-6 text-white flex flex-col min-h-screen justify-between">
  <div id="particles-js"></div>

  <header class="text-center mb-12">
    <img src="./logo.png" alt="Em'Spark Logo" class="mx-auto mb-4 w-28 h-28 drop-shadow-xl">
    <div class="flex justify-end items-center gap-4">
      <!-- ğŸ‘‡ Le bouton Discord -->
      <a href="https://discord.com/channels/1351189337944887316/1351189337944887319" target="_blank"
      class="w-11 h-11 rounded-full bg-indigo-600 flex items-center justify-center shadow-lg hover:shadow-[0_0_15px_4px_rgba(99,102,241,0.8)] transition duration-300"
      title="Rejoindre le Discord">
     <img src="https://cdn-icons-png.flaticon.com/512/5968/5968756.png" alt="Discord"
          class="w-6 h-6 filter drop-shadow-md">
   </a>
   
    
      <!-- ğŸŒ™ Le bouton Mode sombre -->
      <button onclick="toggleDarkMode()" class="bg-black text-white px-4 py-2 rounded shadow hover:bg-gray-800 transition">
        ğŸŒ“ Mode sombre
      </button>
    </div>
  
    <h1 class="text-4xl sm:text-5xl logo-title tracking-wide text-black text-center px-4">EMâ€™SPARK</h1>
    <p class="text-lg sm:text-xl mt-2 text-orange-700 italic text-center px-4">
      CrÃ©e des connexions authentiques autour de tes passions âœ¨
    </p>
    
  </header>
  
  <main class="max-w-6xl mx-auto flex-grow">
    <nav class="flex flex-wrap justify-center gap-4 my-10 flex-col sm:flex-row items-center">
      <a href="#calendar" onclick="showTab('calendar')" class="bg-white text-black rounded-full px-5 py-2 font-semibold shadow hover:bg-orange-300 transition">ğŸ“… Calendrier</a>
      <a href="#chat" onclick="showTab('chat')" class="bg-white text-black rounded-full px-5 py-2 font-semibold shadow hover:bg-orange-300 transition">ğŸ’¬ Discussions</a>
      <a href="#profile" onclick="showTab('profile')" class="bg-white text-black rounded-full px-5 py-2 font-semibold shadow hover:bg-orange-300 transition">ğŸ‘¤ Profil</a>
    </nav>
      
        <section id="calendar" class="fade show text-black">
          <h2 class="text-2xl sm:text-4xl font-bold mb-6 text-center">ğŸ“… Calendrier des Ã‰vÃ©nements</h2>
      
          <!-- Barre de filtres -->
          <div class="flex flex-col md:flex-row justify-center items-center gap-6 mb-6">
            <select id="passionSelect" onchange="filterCalendarByPassion()" class="text-black px-4 py-2 rounded w-64">
              <option value="">-- Toutes les passions --</option>
              <option value="Voyage">âœˆï¸ Voyage</option>
              <option value="Investissement-Finance">ğŸ’° Investissement-Finance</option>
              <option value="Arts">ğŸ¨ Arts-Musique</option>
              <option value="Cuisine">ğŸ‘¨â€ğŸ³ Cuisine-Gastronomie</option>
              <option value="Mode">ğŸ‘— Mode-Style</option>
              <option value="Yoga">ğŸ§˜â€â™‚ï¸ Yoga-MÃ©ditation</option>
              <option value="Jeux">ğŸ® JeuxVidÃ©o</option>
              <option value="Jeux d'argent">ğŸ² Jeux d'argent</option>
              <option value="DÃ©veloppement">ğŸ¤¯ DÃ©veloppement personnel</option>
              <option value="Ecriture">âœï¸ Ecriture</option>
              <option value="SoirÃ©e">ğŸ‰ SoirÃ©e</option>
              <option value="Lecture">ğŸ“š Lecture</option>
              <option value="Sport">âš½ Sport</option>
              <option value="Startup">ğŸ“ˆ Business-Startups</option>
              <option value="Danse">ğŸ’ƒ Danse</option>
              <option value="CinÃ©ma">ğŸ¿ CinÃ©ma</option>
              <option value="Photographie">ğŸ“¸ Photographie</option>
            </select>
          
            <div class="flex items-center gap-3">
              <span class="text-black font-medium">Trier :</span>
              <button onclick="toggleSortOrder()" class="relative w-16 h-8 bg-gray-300 rounded-full shadow-inner transition duration-300 focus:outline-none" id="sortButton">
                <span id="sortCircle" class="absolute left-1 top-1 bg-white w-6 h-6 rounded-full shadow-md transition duration-300"></span>
              </button>
              <span id="sortLabel" class="text-sm font-medium text-black">Prochains d'abord</span>
            </div>
          </div>
          
      
          <!-- RÃ©sultats -->
          <div id="calendar-events" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 px-2"></div>

        </section>
      


    <section id="chat" class="fade hidden text-black">
      <h2 class="text-2xl sm:text-4xl font-bold mb-6 text-center">ğŸ’¬ Discussions par Passion</h2>
      <div class="text-center mb-6">
        <select id="chatSelect" onchange="loadChat()" class="text-black px-4 py-2 rounded shadow">
          <option value="">-- Choisir une passion --</option>
          <option value="Voyage">âœˆï¸ Voyage</option>
          <option value="Investissement-Finance">ğŸ’° Investissement-Finance</option>
          <option value="Arts">ğŸ¨ Arts-Musique</option>
          <option value="Cuisine">ğŸ‘¨â€ğŸ³ Cuisine-Gastronomie</option>
          <option value="Mode">ğŸ‘— Mode-Style</option>
          <option value="Yoga">ğŸ§˜â€â™‚ï¸ Yoga-MÃ©ditation</option>
          <option value="Jeux">ğŸ® JeuxVidÃ©o</option>
          <option value="Jeux d'argent">ğŸ² Jeux d'argent</option>
          <option value="DÃ©veloppement">ğŸ¤¯ DÃ©veloppement personnel</option>
          <option value="Ecriture">âœï¸ Ecriture</option>
          <option value="SoirÃ©e">ğŸ‰ SoirÃ©e</option>
          <option value="Lecture">ğŸ“š Lecture</option>
          <option value="Sport">âš½ Sport</option>
          <option value="Startup">ğŸ“ˆ Business-Startups</option>
          <option value="Danse">ğŸ’ƒ Danse</option>
          <option value="CinÃ©ma">ğŸ¿ CinÃ©ma</option>
          <option value="Photographie">ğŸ“¸ Photographie</option>
        </select>
      </div>

      <div id="chatBox" class="bg-white text-black p-4 rounded shadow max-w-2xl mx-auto space-y-2 min-h-[150px]">
        <p class="text-center text-gray-500">SÃ©lectionne une passion pour afficher le chat correspondant.</p>
      </div>

      <div id="chatFormContainer" class="max-w-2xl mx-auto mt-4 hidden">
        <form onsubmit="sendMessage(event)" class="flex gap-2">
          <input type="text" id="chatInput" placeholder="Ã‰cris ton message..." class="flex-grow px-4 py-2 rounded border border-gray-300 text-black" required>
          <button type="submit" class="bg-orange-600 text-white px-4 py-2 rounded">Envoyer</button>
        </form>
      </div>
    </section>

    <section id="profile" class="fade hidden text-black">
      <h2 class="text-2xl sm:text-4xl font-bold mb-6 text-center">
      <div class="bg-white text-black p-6 rounded shadow max-w-md mx-auto">
        <p class="text-lg font-bold">ConnectÃ© en tant que : <span id="userName">...</span></p>
        <p class="mt-4 text-sm text-gray-600">Ã‰vÃ¨nements en favori :</p>
        <p id="favoritePassion" class="text-orange-600 font-semibold mt-1">Chargement...</p>
    
        <button onclick="logout()" class="mt-6 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">
          ğŸšª Se dÃ©connecter
        </button>
      </div>
    </section>
  </main>

  <script>
    
 const allEvents = [
  {
    passion: "Voyage",
    label: "Roadtrip Normand",
    date: "2025-05-10",
    price: "Gratuit",
    link: "https://www.billetweb.fr/voyage-roadtrip-normand",
    description: "Pars en vadrouille avec d'autres EMiens Ã  travers la Normandie ! Nature, stop imprÃ©vu, souvenirs garantis ğŸŒ¿ğŸš—"
  },
  {
  passion: "Startup",
  label: "Pitch Battle",
  date: "2025-05-12",
  price: "5â‚¬",
  link: "https://www.billetweb.fr/startup-pitch-battle",
  description: "Montre ta start-up en 3 minutes chrono ou viens voter pour le projet le plus stylÃ© du campus ğŸ’¼ğŸ”¥"
},
{
  passion: "Cuisine",
  label: "Atelier CrÃªpes",
  date: "2025-05-14",
  price: "EntrÃ©e libre",
  link: "https://www.billetweb.fr/cuisine-atelier-crepes",
  description: "Team sucre ou team salÃ© ? Viens retourner la pÃ¢te comme un pro et goÃ»ter les crÃªpes des autres ğŸ¥ğŸ‰"
},
{
  passion: "Photographie",
  label: "Expo participative",
  date: "2025-05-15",
  price: "Gratuit",
  link: "https://www.billetweb.fr/photographie-expo-participative",
  description: "Expose tes plus beaux clichÃ©s ou viens te balader dans une expo 100% Ã©tudiante ğŸ“·âœ¨"
},
{
  passion: "CinÃ©ma",
  label: "SoirÃ©e courts-mÃ©trages",
  date: "2025-05-16",
  price: "3â‚¬",
  link: "https://www.billetweb.fr/cinema-soiree-courts-metrages",
  description: "Installe-toi, popcorn Ã  la main, pour une sÃ©lection de courts-mÃ©trages sÃ©lectionnÃ©s par des Ã©tudiants ğŸ¬ğŸ¿"
},
{
  passion: "Sport",
  label: "Tournoi inter-assos",
  date: "2025-05-17",
  price: "Gratuit",
  link: "https://www.billetweb.fr/sport-tournoi-inter-assos",
  description: "Choisis ton Ã©quipe, dÃ©fends tes couleurs et montre qui est le boss sur le terrain âš½ğŸ†"
},
{
  passion: "Danse",
  label: "Battle de danse",
  date: "2025-05-18",
  price: "EntrÃ©e libre",
  link: "https://www.billetweb.fr/danse-battle-de-danse",
  description: "Ambiance street et vibes Ã©lectrisantes, viens danser ou soutenir les talents du campus ğŸ’ƒğŸ•º"
},
{
  passion: "Lecture",
  label: "CafÃ© lecture poÃ©tique",
  date: "2025-05-19",
  price: "Gratuit",
  link: "https://www.billetweb.fr/lecture-cafe-lecture-poetique",
  description: "Une ambiance chill, un bon cafÃ©, et des lectures Ã  voix haute. Parfait pour les rÃªveurs ğŸ“šâ˜•"
},
{
  passion: "Investissement-Finance",
  label: "ConfÃ©rence Pierre Chartier X2007",
  date: "2025-05-21",
  price: "Gratuit",
  link: "https://www.billetweb.fr/investissement-finance-conference-pierre-chartier-x2007",
  description: "Un alumni devenu pro de lâ€™investissement te livre ses clÃ©s pour rÃ©ussir. Notes recommandÃ©es ğŸ’¼ğŸ“ˆ"
},
{
  passion: "Arts",
  label: "Jam session musicale",
  date: "2025-05-22",
  price: "EntrÃ©e libre",
  link: "https://www.billetweb.fr/arts-jam-session-musicale",
  description: "Viens jouer, chanter, improviser ou juste kiffer lâ€™ambiance avec les musiciens de lâ€™Ã©cole ğŸ¸ğŸ¤"
},
{
  passion: "Mode",
  label: "DÃ©filÃ© Ã©tudiants crÃ©ateurs",
  date: "2025-05-23",
  price: "5â‚¬",
  link: "https://www.billetweb.fr/mode-defile-etudiants-createurs",
  description: "Des piÃ¨ces crÃ©Ã©es par des Ã©tudiants, un vrai show-mode sur tapis rouge ğŸ‘—âœ¨"
},
{
  passion: "Yoga",
  label: "Yoga Sunset Rooftop",
  date: "2025-05-24",
  price: "Gratuit",
  link: "https://www.billetweb.fr/yoga-yoga-sunset-rooftop",
  description: "Respire, Ã©tire-toi, recentre-toi face au coucher du soleil sur les toits de Caen ğŸ§˜â€â™€ï¸ğŸŒ‡"
},
{
  passion: "DÃ©veloppement",
  label: "Atelier Confiance en soi",
  date: "2025-05-25",
  price: "Gratuit",
  link: "https://www.billetweb.fr/developpement-atelier-confiance-en-soi",
  description: "Un boost de motivation, dâ€™estime et dâ€™Ã©nergie. Parfait avant les oraux ou entre deux partiels ğŸŒŸğŸ’¬"
},
{
  passion: "Ecriture",
  label: "SoirÃ©e micro-ouvert",
  date: "2025-05-26",
  price: "EntrÃ©e libre",
  link: "https://www.billetweb.fr/ecriture-soiree-micro-ouvert",
  description: "Lis ton texte, slam ton poÃ¨me, raconte ton histoire. SoirÃ©e micro ouvert pour libÃ©rer ta voix âœï¸ğŸ™ï¸"
},
{
  passion: "Jeux d'argent",
  label: "Tournoi de poker Ã©tudiant",
  date: "2025-05-28",
  price: "10â‚¬",
  link: "https://www.billetweb.fr/jeux-dargent-tournoi-de-poker-etudiant",
  description: "Mets ton plus beau bluff, lis dans les regards... et rafle la mise ğŸƒğŸ’¸"
},
{
  passion: "Jeux d'argent",
  label: "Initiation au blackjack",
  date: "2025-05-29",
  price: "Gratuit",
  link: "https://www.billetweb.fr/jeux-dargent-initiation-au-blackjack",
  description: "Tu connais le 21 ? Viens apprendre les bases du blackjack, sans pression, juste pour le fun â™ ï¸ğŸ²"
}
]; 


const chatMessages = {
      "Voyage": ["LÃ©a : Qui part en Espagne cet Ã©tÃ© ?", "Alex : Jâ€™ai une tente en rab !"],
      "Investissement-Finance": ["Sami : Qui va Ã  la conf' avec Pierre Chartier ?", "LÃ©on : Bien SÃ»rrrr guysss !"],
      "Arts": ["ChloÃ© : Vernissage ce vendredi", "Yacine : Session dessin dimanche ?"],
      "Cuisine": ["Camille : Recette facile ?", "Tom : Jâ€™apporte le dessert ğŸ°"],
      "Mode": ["Lina : DÃ©filÃ© vintage samedi !", "Sophie : Friperie Ã  Paris ğŸ˜"],
      "Yoga": ["Mehdi : MÃ©ditation demain ğŸŒ", "Emma : Respiration ?"],
      "Jeux": ["Nico : LoL ce soir ?", "Katia : Mario Kart ğŸ˜†"],
      "Jeux d'argent": ["Sami : Poker ce soir ?", "LÃ©on : On mise quoi ? ğŸ˜"],
      "DÃ©veloppement": ["Sarah : Des livres Ã  recommander ?", "Youssef : Journal de gratitude ğŸ’¡"],
      "Ecriture": ["Maya : Concours poÃ©sie", "Nina : Battle de textes âœï¸"],
      "SoirÃ©e": ["Lucas : Blind test vendredi", "Imane : Snacks ğŸ‰"],
      "Lecture": ["Nora : Vous lisez quoi ?", "Moussa : Slam ğŸ’«"],
      "Sport": ["Anas : Foot dimanche âš½", "Emma : BinÃ´me running ğŸƒâ€â™€ï¸"],
      "Startup": ["ClÃ©ment : Pitch demain ğŸ˜…", "Sarah : Dev freelance ?"],
      "Danse": ["Lola : Atelier afro !", "Jules : Battle samedi ğŸ’ƒ"],
      "CinÃ©ma": ["Yohan : Avant-premiÃ¨re ce soir", "ZoÃ© : Nolan ?"],
      "Photographie": ["Jade : Expo demain ğŸ“¸", "Ben : ModÃ¨les pour projet"]
    }

    const usersKey = "emsparkUsers";
const activeUserKey = "activeEmsparkUser";

function getUsers() {
  return JSON.parse(localStorage.getItem(usersKey)) || [];
}
function saveUsers(users) {
  localStorage.setItem(usersKey, JSON.stringify(users));
}
function getActiveUser() {
  const username = localStorage.getItem(activeUserKey);
  return getUsers().find(u => u.username === username);
}
    let sortByUpcoming = true;
    let currentChat = "";
    let currentEventId = null;

    function initializeApp() {
  showTab('calendar');
  renderCalendarEvents();
}

    function showTab(tabId) {
      ['calendar', 'chat', 'profile'].forEach(id => {
        const tab = document.getElementById(id);
        tab.classList.add('hidden');
        tab.classList.remove('show');
      });
      const activeTab = document.getElementById(tabId);
      activeTab.classList.remove('hidden');
      setTimeout(() => activeTab.classList.add('show'), 10);
      if (tabId === 'profile') loadFavoritePassion();
    }

    function toggleSortOrder() {
  sortByUpcoming = !sortByUpcoming;

  // Changement de texte
  document.getElementById("sortLabel").innerText = sortByUpcoming
    ? "Prochains d'abord"
    : "Les plus loins d'abord";

  // Animation du cercle du toggle
  const circle = document.getElementById("sortCircle");
  if (sortByUpcoming) {
    circle.classList.remove("translate-x-8");
  } else {
    circle.classList.add("translate-x-8");
  }

  renderCalendarEvents();
}

    function renderCalendarEvents() {
  const container = document.getElementById("calendar-events");
  const favs = getFavorites();
  const selectedPassion = document.getElementById("passionSelect")?.value || "";

  const sorted = [...allEvents]
    .filter(e => selectedPassion === "" || e.passion === selectedPassion)
    .sort((a, b) =>
      sortByUpcoming
        ? new Date(a.date) - new Date(b.date)
        : new Date(b.date) - new Date(a.date)
    );

    container.innerHTML = sorted.length > 0
  ? sorted.map(e => `
    <div data-event-index="${allEvents.indexOf(e)}"
     onclick="handleOpenEventClick(event)"
         class="cursor-pointer bg-white text-black rounded-2xl shadow p-5 relative transition transform hover:scale-105 hover:shadow-lg">
      <h3 class="text-lg sm:text-xl font-semibold mb-1">${e.passion} â€” ${e.label}</h3>
      <p class="text-sm text-gray-600">${e.date} â€” ${e.price}</p>
    </div>
  `).join('')
  : '<p class="text-center w-full">Aucun Ã©vÃ©nement pour cette passion.</p>';

}
function filterCalendarByPassion() {
  renderCalendarEvents();
}

    function eIndex(e) {
      return `${e.passion}-${e.label}`;
    }
    function emojiForPassion(passion) {
  const emojis = {
    "Voyage": "âœˆï¸", "Startup": "ğŸ“ˆ", "Cuisine": "ğŸ‘¨â€ğŸ³", "Photographie": "ğŸ“¸",
    "CinÃ©ma": "ğŸ¿", "Sport": "âš½", "Danse": "ğŸ’ƒ", "Lecture": "ğŸ“š",
    "JeuxVidÃ©o": "ğŸ®", "Investissement": "ğŸ’°", "Arts": "ğŸ¨", "Mode": "ğŸ‘—",
    "Yoga": "ğŸ§˜â€â™‚ï¸", "DÃ©veloppement": "ğŸ¤¯", "Ecriture": "âœï¸", "SoirÃ©e": "ğŸ‰",
    "Jeux d'argent": "ğŸ²"
  };
  return emojis[passion] || "âœ¨";
}
function getFavorites() {
  const user = getActiveUser();
  return user?.favorites || [];
}

function toggleFavorite(id, e) {
  if (e) e.stopPropagation(); // EmpÃªche d'ouvrir la modale

  const users = getUsers();
  const user = getActiveUser();
  if (!user) return;

  let favs = user.favorites || [];
  const index = favs.indexOf(id);
  if (index === -1) {
    favs.push(id);
  } else {
    favs.splice(index, 1);
  }

  // Mise Ã  jour des users dans le localStorage
  const updatedUsers = users.map(u =>
    u.username === user.username ? { ...u, favorites: favs } : u
  );

  saveUsers(updatedUsers);
  renderCalendarEvents(); // Pour mettre Ã  jour les ğŸ’–
}


function loadFavoritePassion() {
  const user = getActiveUser();
  document.getElementById("favoritePassion").textContent = user?.favorites?.join(", ") || "Aucune passion favorite";
  document.getElementById("userName").textContent = user?.username || "Utilisateur inconnu";
}

function loadChat() {
  const value = document.getElementById("chatSelect").value;
  const box = document.getElementById("chatBox");
  const form = document.getElementById("chatFormContainer");
  currentChat = value;

  if (!value || !chatMessages[value]) {
    box.innerHTML = `<p class="text-center text-gray-500">SÃ©lectionne une passion pour afficher le chat correspondant.</p>`;
    form.classList.add("hidden");
    return;
  }

  const messages = chatMessages[value];
  box.innerHTML = messages.length > 0
    ? messages.map(msg => {
        const [name, text] = msg.split(" : ");
        const isYou = name.trim().toLowerCase() === "toi";
        return `
          <div class="flex ${isYou ? 'justify-end' : 'justify-start'} animate-slide-in">
            <div class="max-w-xs rounded-xl px-4 py-2 mb-2 shadow 
              ${isYou ? 'bg-orange-100 text-orange-900' : 'bg-gray-100 text-gray-800'}">
              <p class="text-xs font-semibold mb-1">${name}</p>
              <p>${text}</p>
            </div>
          </div>
        `;
      }).join('')
    : `<p class="text-center text-gray-500">Aucun message pour cette passion. Lance la discussion !</p>`;

  form.classList.remove("hidden");
}

    function sendMessage(e) {
      e.preventDefault();
      const input = document.getElementById("chatInput");
      const message = input.value.trim();
      if (message === "" || currentChat === "") return;
      chatMessages[currentChat].push(`Toi : ${message}`);
      input.value = "";
      loadChat();
    }

    // Particles
    particlesJS("particles-js", {
  particles: {
    number: { value: 70 },
    color: { value: "#1f2937" },
    shape: { type: "circle" },
    opacity: { value: 0.5 },
    size: { value: 4, random: true },
    line_linked: {
      enable: true,
      distance: 120,
      color: "#1f2937",
      opacity: 0.4,
      width: 1
    },
    move: { enable: true, speed: 1.5 }
  },
  interactivity: {
  detect_on: "window",
  events: {
    onhover: { enable: true, mode: "repulse" },
    onclick: { enable: true, mode: "push" },
    resize: true
  },
  modes: {
    repulse: { distance: 100 },
    push: { particles_nb: 4 }
  }
}, // â† il manquait cette virgule ici pour sÃ©parer les objets
  retina_detect: true
});
function toggleFavoriteFromModal() {
  const user = getActiveUser();
  if (!user) return;

  const users = getUsers();
  const favs = user.favorites || [];
  const index = favs.indexOf(currentEventId);

  if (index === -1) {
    favs.push(currentEventId);
  } else {
    favs.splice(index, 1);
  }

  const updatedUsers = users.map(u =>
    u.username === user.username ? { ...u, favorites: favs } : u
  );

  saveUsers(updatedUsers);
  loadFavoritePassion();

  const button = document.getElementById("favoriteButton"); // ğŸ‘ˆ AJOUT OBLIGATOIRE
  const isFav = favs.includes(currentEventId);

  // Mise Ã  jour du texte
  button.innerText = isFav ? "ğŸ’– Retirer des favoris" : "ğŸ¤ Ajouter aux favoris";

  // On enlÃ¨ve toutes les anciennes classes
  button.classList.remove("bg-pink-100", "text-pink-600", "bg-orange-100", "text-orange-700");

  // Et on remet celles qui conviennent
  if (isFav) {
    button.classList.add("bg-pink-100", "text-pink-600");
  } else {
    button.classList.add("bg-orange-100", "text-orange-700");
  }
}



  function logout() {
    localStorage.removeItem(activeUserKey);
    window.location.href = "index.html";
  }

</script>
<!-- ğŸ”½ MODALE DE L'Ã‰VÃ‰NEMENT ğŸ”½ -->
<div id="eventModal" class="fixed inset-0 z-50 bg-black bg-opacity-60 hidden flex items-center justify-center">
  <div class="bg-white text-black p-6 rounded-xl shadow-lg w-[90%] max-w-md relative">
    
    <!-- âŒ Bouton de fermeture -->
    <button onclick="closeEventModal()" class="absolute top-3 right-4 text-gray-400 hover:text-red-500 text-2xl font-bold">Ã—</button>

    <!-- Header Ã©vÃ©nement -->
    <div class="flex items-center gap-3 mb-4">
      <div class="text-3xl" id="modalEmoji">âœ¨</div>
      <h3 id="modalTitle" class="text-2xl font-extrabold"></h3>
    </div>

    <!-- DÃ©tails (Date + Prix) -->
    <div class="flex flex-wrap gap-2 text-sm mb-4">
      <span id="modalDate" class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full"></span>
      <span id="modalPrice" class="bg-green-100 text-green-700 px-3 py-1 rounded-full"></span>
    </div>

    <!-- Description -->
    <p id="modalDesc" class="text-sm text-gray-700 mb-6 leading-relaxed"></p>

    <!-- Boutons -->
    <div class="flex flex-col gap-3">
      <button id="favoriteButton"
        onclick="toggleFavoriteFromModal()"
        class="py-2 w-full font-semibold rounded-xl transition
        bg-orange-100 text-orange-700 hover:bg-orange-200 text-center text-sm">
        ğŸ¤ Ajouter aux favoris
      </button>

      <a id="modalLink" target="_blank"
        class="py-2 w-full font-semibold rounded-xl transition
        bg-pink-500 text-white hover:bg-pink-600 text-center text-sm">
        ğŸŸï¸ Je participe
      </a>
    </div>
  </div>
</div>


<script>
  function toggleDarkMode() {
    document.body.classList.toggle('dark');
  }

  function openEventModal(eventData) {
  const modal = document.getElementById("eventModal");
  const title = document.getElementById("modalTitle");
  const date = document.getElementById("modalDate");
  const price = document.getElementById("modalPrice");
  const link = document.getElementById("modalLink");
  const desc = document.getElementById("modalDesc");
  const favButton = document.getElementById("favoriteButton");

  // DÃ©finit l'ID unique de l'Ã©vÃ©nement
  currentEventId = eIndex(eventData);

  // RÃ©cupÃ¨re si cet Ã©vÃ©nement est dÃ©jÃ  en favori
  const isFav = getFavorites().includes(currentEventId);

  // Remplit les infos dans la modale
  title.textContent = eventData.label;
  date.textContent = `ğŸ“… ${eventData.date}`;
  price.textContent = `ğŸ’¶ ${eventData.price}`;
  link.href = eventData.link;
  desc.textContent = eventData.description;

  // Met Ã  jour le style du bouton favori
  favButton.innerText = isFav ? "ğŸ’– Retirer des favoris" : "ğŸ¤ Ajouter aux favoris";
  favButton.classList.toggle("bg-pink-100", isFav);
  favButton.classList.toggle("text-pink-600", isFav);
  favButton.classList.toggle("bg-orange-100", !isFav);
  favButton.classList.toggle("text-orange-700", !isFav);

  document.getElementById("modalEmoji").textContent = emojiForPassion(eventData.passion);

  modal.classList.remove("hidden");
}


  function closeEventModal() {
    const modal = document.getElementById("eventModal");
    modal.classList.remove("show");
    setTimeout(() => modal.classList.add("hidden"), 200);
  }
  function handleOpenEventClick(event) {
  const index = event.currentTarget.getAttribute("data-event-index");
  const eventData = allEvents[index];
  openEventModal(eventData);
}
</script>
</body>
</html>
